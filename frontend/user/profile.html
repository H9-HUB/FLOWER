<!-- ä¸ªäººä¸­å¿ƒ -->
<!doctype html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <title>ä¸ªäººä¸­å¿ƒ</title>
    <link href="css/style.css" rel="stylesheet">
    <link href="https://cdn.staticfile.net/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="page-profile">
    <!-- ç»Ÿä¸€å¯¼èˆªç”± js/common.js æ³¨å…¥ -->
    <div class="profile-shell">
        <section class="profile-hero glass">
            <div class="profile-meta">
                <div class="profile-avatar" id="profileAvatar" style="background:#eee;color:#666;font-size:2.2rem;display:flex;align-items:center;justify-content:center;">
                    <!-- å¤´åƒé¦–å­—æ¯/æ±‰å­—ç”±jsæ³¨å…¥ -->
                </div>
                <div>
                    <div class="profile-hello">Hi, <span id="username" style="color:inherit;font-weight:600"></span></div>
                    <div class="profile-phone">å½“å‰æ‰‹æœºå·ï¼š<span id="phone" class="text-muted"></span></div>
                    <div class="profile-hint">æ¬¢è¿å›æ¥ï¼Œä¿æŒç™»å½•äº«å—ä¼šå‘˜æƒç›Šä¸ä¸“å±ä¼˜æƒ </div>
                </div>
            </div>
            <div class="profile-actions">
                <a class="pill-btn primary" href="list.html">å»å•†åŸ</a>
                <a class="pill-btn ghost" href="orders.html">è®¢å•è®°å½•</a>
            </div>
        </section>

        <section class="profile-summary">
            <div class="summary-card">
                <div>
                    <div class="summary-label">è®¢å•æ¦‚è§ˆ</div>
                    <div class="summary-desc">æ€»è®¢å•ï¼š<span id="totalOrdersCount">--</span>ï¼Œå·²å®Œæˆï¼š<span id="paidOrdersCount">--</span></div>
                </div>
                <a class="pill-btn ghost" href="orders.html">å»æŸ¥çœ‹</a>
            </div>
            <div class="summary-card">
                <div>
                    <div class="summary-label">åœ°å€ç®¡ç†</div>
                    <div class="summary-desc">å¸¸ç”¨åœ°å€åŠ©åŠ›å¿«é€Ÿä¸‹å•</div>
                </div>
                <a class="pill-btn ghost" href="address.html">å»ç®¡ç†</a>
            </div>
            <div class="summary-card">
                <div>
                    <div class="summary-label">ä¼˜æƒ ä¸ä¼šå‘˜</div>
                    <div class="summary-desc">ä¸å®šæ—¶è·å¾—ä¼˜æƒ åˆ¸ï¼Œäº«å—ä¼šå‘˜æƒç›Š</div>
                </div>
                <a class="pill-btn ghost" href="list.html">å»é€›é€›</a>
            </div>
        </section>

        <section class="profile-stats">
            <div class="stat-card">
                <div class="stat-icon">ğŸ§¾</div>
                <div>
                    <div class="stat-label">æˆ‘çš„è®¢å•</div>
                    <div class="stat-desc">æ”¯ä»˜ã€æŸ¥çœ‹ã€å–æ¶ˆ</div>
                </div>
                <a class="stat-link" href="orders.html">è¿›å…¥</a>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ </div>
                <div>
                    <div class="stat-label">æ”¶è´§åœ°å€</div>
                    <div class="stat-desc">å¸¸ç”¨åœ°å€å¿«æ·ä¸‹å•</div>
                </div>
                <a class="stat-link" href="address.html">ç®¡ç†</a>
            </div>
            <div class="stat-card">
                <div class="stat-icon">ğŸ›’</div>
                <div>
                    <div class="stat-label">è´­ç‰©è½¦</div>
                    <div class="stat-desc">ç»§ç»­æŒ‘é€‰å–œæ¬¢çš„èŠ±</div>
                </div>
                <a class="stat-link" href="cart.html">æŸ¥çœ‹</a>
            </div>
        </section>

        <section class="quick-links">
            <div class="ql-head">å¿«æ·å…¥å£</div>
            <div class="ql-grid">
                <a class="ql-item" href="orders.html">
                    <div class="ql-title">æˆ‘çš„è®¢å•</div>
                    <div class="ql-desc">æŸ¥çœ‹å…¨éƒ¨è®¢å•ã€æ”¯ä»˜å’Œå–æ¶ˆ</div>
                </a>
                <a class="ql-item" href="address.html">
                    <div class="ql-title">æ”¶è´§åœ°å€</div>
                    <div class="ql-desc">ç®¡ç†å¸¸ç”¨åœ°å€ï¼Œè½»æ¾ä¸‹å•</div>
                </a>
                <a class="ql-item" href="cart.html">
                    <div class="ql-title">è´­ç‰©è½¦</div>
                    <div class="ql-desc">ç»§ç»­æŒ‘é€‰å¿ƒä»ªèŠ±å“</div>
                </a>
                <a class="ql-item" href="mailto:support@floraldreams.local">
                    <div class="ql-title">è”ç³»å®¢æœ</div>
                    <div class="ql-desc">é—®é¢˜åé¦ˆä¸å”®åæ”¯æŒ</div>
                </a>
            </div>
        </section>

        <section class="support-panel glass">
            <div>
                <div class="support-title">å®¢æœä¸å®‰å…¨æç¤º</div>
                <ul class="support-list">
                    <li>è®¢å•ä¸æ”¯ä»˜é—®é¢˜ä¼˜å…ˆé€šè¿‡è®¢å•è¯¦æƒ…é¡µæäº¤ã€‚</li>
                    <li>è¯·å‹¿æ³„éœ²è´¦å·éªŒè¯ç ï¼Œæ³¨æ„é˜²èŒƒé’“é±¼é“¾æ¥ã€‚</li>
                    <li>è‹¥éœ€äººå·¥ååŠ©ï¼Œé‚®ä»¶è”ç³» support@floraldreams.localã€‚</li>
                </ul>
            </div>
            <a class="pill-btn primary" href="mailto:support@floraldreams.local">è”ç³»æ”¯æŒ</a>
        </section>
    </div>
        <script src="js/common.js"></script>
        <script>
                        document.addEventListener('DOMContentLoaded', () => {
                                const username = localStorage.getItem('username');
                                const phone = localStorage.getItem('phone');
                                // ç”¨æˆ·åä¼˜å…ˆï¼Œæ— åˆ™æ‰‹æœºå·ï¼Œæ— åˆ™é»˜è®¤
                                const displayName = username || (phone ? phone : 'Floral Friend');
                                document.getElementById('username').textContent = displayName;
                                document.getElementById('phone').textContent = phone || '-';
                                // å¤´åƒé¦–å­—æ¯/æ±‰å­—
                                const avatarEl = document.getElementById('profileAvatar');
                                let firstChar = displayName.trim().charAt(0) || '?';
                                avatarEl.textContent = firstChar;
                                // é¢œè‰²è‡ªé€‚åº”ï¼šå–ä¸»è‰²æˆ–éšæœºæŸ”å’Œè‰²
                                const colorList = [
                                    '#43a047','#66bb6a','#a5d6a7','#e8f5e9','#c8e6c9','#388e3c','#81c784','#b9f6ca','#ffffff','#e0f2f1'
                                ];
                                // ç”¨ç”¨æˆ·å/æ‰‹æœºå·çš„unicodeå’Œåšhashé€‰è‰²
                                let hash = 0;
                                for(let i=0;i<displayName.length;i++) hash = displayName.charCodeAt(i) + ((hash<<5)-hash);
                                const color = colorList[Math.abs(hash)%colorList.length];
                                avatarEl.style.background = color;
                                avatarEl.style.color = (color==='#ffffff'||color==='#e8f5e9'||color==='#e0f2f1'||color==='#b9f6ca'||color==='#a5d6a7'||color==='#c8e6c9') ? '#388e3c' : '#fff';
                                loadOrderStats();
                        });

            async function loadOrderStats(){
                if(!requireAuth({ message: 'è¯·å…ˆç™»å½•åæŸ¥çœ‹è®¢å•æ¦‚è§ˆ', waitConfirm: true })) return;
                try {
                    const res = await httpGet('/api/orders');
                    if(res.code === 200 && Array.isArray(res.data)){
                        const total = res.data.length;
                        const paid = res.data.filter(o => o.status === 'PAID').length;
                        document.getElementById('totalOrdersCount').textContent = total;
                        document.getElementById('paidOrdersCount').textContent = paid;
                    } else {
                        document.getElementById('totalOrdersCount').textContent = '--';
                        document.getElementById('paidOrdersCount').textContent = '--';
                    }
                } catch (e) {
                    document.getElementById('totalOrdersCount').textContent = '--';
                    document.getElementById('paidOrdersCount').textContent = '--';
                }
            }
        </script>
</body>

</html>